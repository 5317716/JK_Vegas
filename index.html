<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>JK‚Äôs Bucks Night 2026</title>
<style>
  :root { --primary: #4CAF50; --bg: #121212; --card: #1e1e1e; --text: #ffffff; --border: #333; --danger: #f44336; --accent: #FFD700; --blue: #2196F3; --purple: #8e44ad; --whatsapp: #25D366; }
  
  * { box-sizing: border-box; }

  html, body { 
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
    background-color: var(--bg); color: var(--text); 
    margin: 0; padding: 0; height: 100%; width: 100%; 
    position: fixed; top: 0; left: 0; overflow: hidden; overscroll-behavior: none;
    font-size: 16px; 
  }
  
  .view { display: none; height: 100%; width: 100%; position: absolute; top: 0; left: 0; flex-direction: column; background: var(--bg); overflow-y: auto; padding-bottom: 60px; overflow-x: hidden; }
  .active-view { display: flex !important; }

  .app-container { width: 100%; height: 100%; display: flex; flex-direction: column; position: relative; }
  #mainContent { flex: 1; padding: 15px; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 140px; }

  .top-info-bar { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: #000; border-bottom: 1px solid #333; flex-shrink: 0; width: 100%; }
  .room-tag { font-family: monospace; font-weight: bold; color: var(--accent); font-size: 18px; }
  
  .dash-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; width: 100%; padding: 0 5px; }
  .btn-logout { background: none; border: 1px solid #444; color: #888; padding: 8px 15px; border-radius: 8px; font-size: 14px; white-space: nowrap; }

  .hole-jump-select { width: 100%; padding: 15px; background: #222; color: var(--primary); border: 1px solid #444; border-radius: 10px; font-weight: bold; margin-bottom: 12px; font-size: 1.1rem; text-align-last: center; appearance: none; -webkit-appearance: none; }
  .btn-share-top { background: var(--blue); color: white; border: none; padding: 8px 14px; border-radius: 8px; font-weight: bold; font-size: 11px; margin-right: 5px; }
  .btn-whatsapp { background: var(--whatsapp); color: white; border: none; padding: 8px 14px; border-radius: 8px; font-weight: bold; font-size: 11px; }

  #leaderboardDrawer { 
    position: absolute; bottom: 0; left: 0; width: 100%; height: 88%; 
    background: #1a1a1a; border-top: 4px solid var(--primary); 
    border-top-left-radius: 25px; border-top-right-radius: 25px;
    z-index: 2000; transition: transform 0.4s cubic-bezier(0.1, 0.7, 0.1, 1);
    transform: translateY(105%); display: flex; flex-direction: column;
  }
  #leaderboardDrawer.open { transform: translateY(0); }
  .ldr-body { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 15px; }
  .table-scroll { width: 100%; overflow-x: auto; margin-top: 15px; background: #000; border-radius: 12px; -webkit-overflow-scrolling: touch; }

  .row-drink { background: rgba(33, 150, 243, 0.1) !important; color: #90caf9; }
  .row-gamble { background: rgba(255, 215, 0, 0.08) !important; color: #fff59d; }
  .row-sundry { background: rgba(142, 68, 173, 0.1) !important; color: #d7bde2; }

  .detail-box { text-align: left; padding: 15px; border-radius: 10px; margin-top: 10px; font-size: 14px; border: 1px solid var(--border); background: var(--card); line-height: 1.4; }
  .btn-main { background: var(--primary); color: white; border: none; width: 100%; padding: 22px; border-radius: 15px; margin-bottom: 12px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
  .btn-side { flex: 1; background: #444; color: white; border: none; padding: 18px; border-radius: 12px; font-weight: bold; font-size: 0.9rem; text-align: center; display: flex; align-items: center; justify-content: center; text-decoration: none; }
  
  input { width: 100%; max-width: 100%; padding: 18px; border-radius: 12px; border: 1px solid #444; background: #222; color: #fff; margin-bottom: 10px; text-align: center; font-size: 1.1rem; }
  
  .floating-toggle { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--primary); color: white; padding: 18px 45px; border-radius: 50px; font-weight: bold; box-shadow: 0 8px 20px rgba(0,0,0,0.6); z-index: 1500; border: 2px solid #fff; }
  table { width: 100%; border-collapse: collapse; font-size: 11px; color: white; }
  th, td { border: 1px solid #333; padding: 10px; text-align: center; min-width: 150px; }
  .admin-item { background: #252525; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; }
</style>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>

  <div id="authView" class="view active-view" style="justify-content: center; align-items: center; text-align: center; padding: 20px;">
    <h1 style="color:var(--primary); font-size: 2rem; margin-bottom: 30px;">‚õ≥ JK‚ÄôS BUCKS 2026</h1>
    <input type="text" id="logUser" placeholder="Your Name">
    <input type="password" id="logPass" placeholder="Password">
    <button class="btn-main" onclick="handleAuth()">Login / Create Account</button>
  </div>

  <div id="dashView" class="view" style="padding: 20px;">
    <div class="dash-header"><h2 id="dashTitle" style="margin:0;">G'day</h2><button class="btn-logout" onclick="logout()">Logout üëã</button></div>
    <div id="activeGamesSection">
        <h3 style="color: var(--primary);">Active Games</h3>
        <div id="activeList"></div>
        <div style="margin-top: 20px; border-top: 1px solid #333; padding-top: 20px;">
            <input type="text" id="newRoomCode" placeholder="Room Code" maxlength="4">
            <button class="btn-main" style="background: var(--blue);" onclick="joinGame()">Join New Room</button>
            <button class="btn-main" onclick="createGame()">üëë Host New Game</button>
        </div>
    </div>
    <div style="margin-top: 30px;"><h3 style="color: var(--accent);">History</h3><div id="historyList"></div></div>
    <button id="adminBtn" class="btn-main" style="display:none; background:var(--purple); margin-top:30px;" onclick="v('dashView', 0); v('adminView', 1); loadAdmin();">‚öôÔ∏è SYSTEM ADMIN</button>
  </div>

  <div id="rulesView" class="view" style="padding: 20px;">
    <h2 style="color:var(--primary);">THE RULES & OVERVIEW</h2>
    <button class="btn-main" style="background:#444;" onclick="v('rulesView', 0); v('gameView', 1);">Back to Game</button>
    <div class="detail-box"><b>üç∫ Drink Par:</b> Sips/gulps to finish.<br><b>üíµ Gambling Par ($10 Buy-in):</b><br>‚Ä¢ Birdie (-1): Profit (Win >$10)<br>‚Ä¢ Par (0): Break Even ($10)<br>‚Ä¢ Bogey (+1): Loss ($0)<br>‚Ä¢ Penalty (+3): Refusal</div>
    <div class="detail-box" style="border-color:var(--accent);"><b>üëë JOEL'S ODD-NUMBER RULE:</b> Odd number of players for Fairway coin flips? Joel must find a total stranger on the Strip to take his $10 bet.</div>
    <div class="detail-box" style="border-color:var(--danger);"><b>üö® HAZARDS & PENALTIES:</b><br>‚Ä¢ <b>Dirty PBR Backup (Hole 10):</b> No pickle juice? Ask for olive brine. Still no? Mandatory Boilermaker.<br>‚Ä¢ <b>The Curdle (+2 Sundry):</b> Hesitating on the Car Bomb.<br>‚Ä¢ <b>The Malt Liquor (+2 Sundry):</b> Entering the Wynn before finishing the Colt 45.<br>‚Ä¢ <b>Out of Bounds (+3 Sundry):</b> Vomiting.</div>
    <h3 style="color:var(--primary); margin-top:25px;">COURSE GUIDE</h3>
    <div id="fullCourseList"></div>
  </div>

  <div id="adminView" class="view" style="padding: 20px;">
    <h2 style="color:var(--purple);">Admin Panel</h2>
    <button class="btn-main" style="background:#444;" onclick="v('adminView', 0); v('dashView', 1);">Back to Dashboard</button>
    <div style="background: #3d1414; padding: 15px; border-radius: 12px; border: 2px solid var(--danger); margin-bottom: 20px;">
      <h4 style="margin:0; color:var(--danger);">Nuclear Option</h4>
      <button class="btn-main" style="background:var(--danger); padding:10px; font-size:14px; margin-top:10px;" onclick="globalReset()">WIPE ALL DATA</button>
    </div>
    <h3>Users</h3><div id="adminUserList"></div>
    <h3>Games</h3><div id="adminGameList"></div>
  </div>

  <div id="gameView" class="view" style="padding: 0;">
    <div class="app-container">
        <div class="top-info-bar">
            <div>CODE: <span id="roomTag" class="room-tag">----</span></div>
            <div style="display: flex;">
              <button class="btn-share-top" onclick="shareCode()">INVITE üì≤</button>
              <button onclick="exitGame()" style="background: #333; color: #fff; border: none; padding: 8px 14px; border-radius: 8px; font-weight: bold; font-size: 12px;">EXIT</button>
            </div>
        </div>
        <div id="mainContent">
            <select id="activeUserSelect" class="hole-jump-select" style="background:var(--purple); color:white; margin-bottom:8px;" onchange="switchUser(this.value)"></select>
            <select id="holeJump" class="hole-jump-select" onchange="jumpHole(this.value)"></select>
            <div class="hole-header" id="holeInfo"></div>
            
            <div style="background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 12px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span>üç∫ Drinks</span>
                    <div style="display: flex; align-items: center; background: #2a2a2a; border-radius: 12px; padding: 4px;">
                        <button style="background: #333; border: none; width: 50px; height: 50px; color: white; font-size: 20px; border-radius: 10px;" onclick="adj('d',-1)">‚àí</button>
                        <div style="font-size: 1.8rem; width: 60px; text-align: center; color: var(--primary);" id="dDisp">0</div>
                        <button style="background: #333; border: none; width: 50px; height: 50px; color: white; font-size: 20px; border-radius: 10px;" onclick="adj('d',1)">+</button>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span>üé≤ Gambling</span>
                    <div style="display: flex; align-items: center; background: #2a2a2a; border-radius: 12px; padding: 4px;">
                        <button style="background: #333; border: none; width: 50px; height: 50px; color: white; font-size: 20px; border-radius: 10px;" onclick="adj('g',-1)">‚àí</button>
                        <div style="font-size: 1.8rem; width: 60px; text-align: center; color: var(--primary);" id="gDisp">0</div>
                        <button style="background: #333; border: none; width: 50px; height: 50px; color: white; font-size: 20px; border-radius: 10px;" onclick="adj('g',1)">+</button>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>‚ú® Sundries</span>
                    <div style="display: flex; align-items: center; background: #2a2a2a; border-radius: 12px; padding: 4px;">
                        <button style="background: #333; border: none; width: 50px; height: 50px; color: white; font-size: 20px; border-radius: 10px;" onclick="adj('s',-1)">‚àí</button>
                        <div style="font-size: 1.8rem; width: 60px; text-align: center; color: var(--purple);" id="sDisp">0</div>
                        <button style="background: #333; border: none; width: 50px; height: 50px; color: white; font-size: 20px; border-radius: 10px;" onclick="adj('s',1)">+</button>
                    </div>
                </div>
            </div>
            
            <button class="btn-main" style="background:var(--blue);" onclick="saveHole()">üíæ Save Hole Score</button>
            <button class="btn-main" style="background:#444;" onclick="v('gameView', 0); v('rulesView', 1);">üìú THE RULES & OVERVIEW</button>

            <div id="hostPanel" style="display:none; background:#3d1414; padding:15px; border-radius:12px; border: 2px solid var(--danger); margin-bottom: 15px;">
                <h3 style="margin-top:0; font-size:12px; color:var(--danger); text-align:center;">üö® HOST PANEL</h3>
                <div style="display:flex; gap:5px; margin-bottom:12px;">
                    <input type="text" id="newFellaName" placeholder="Mate's Name" style="margin-bottom:0; flex:1; font-size:14px;">
                    <button style="background:var(--primary); border:none; color:white; padding:10px; border-radius:10px; font-weight:bold;" onclick="addFella()">ADD FELLA</button>
                </div>
                <button class="btn-main" style="background: #555; font-size: 12px; margin-top: 5px; padding: 10px;" onclick="archiveGame()">üõë ARCHIVE GAME FOR ALL</button>
            </div>

            <div style="display:flex; gap:10px;">
                <a href="https://www.google.com/maps/dir/Park+MGM/Mama+Rabbit/The+Fairway/The+Cosmopolitan+of+Las+Vegas/The+Chandelier/Caesars+Palace/Tilted+Kilt+Pub+%26+Eatery" target="_blank" class="btn-side" style="background:#ea4335;">üöÄ Front 9 GPS</a>
                <a href="https://www.google.com/maps/dir/Wynn+Las+Vegas/Encore+at+Wynn+Las+Vegas/Peppermill+Restaurant+and+Fireside+Lounge/Fremont+Street+Experience/Circa+Resort+%26+Casino/Golden+Gate+Hotel+%26+Casino/Golden+Nugget+Las+Vegas/Binion's+Gambling+Hall" target="_blank" class="btn-side" style="background:#fbbc05;">üöÄ Back 9 GPS</a>
            </div>
        </div>
        
        <div id="leaderboardDrawer">
            <div class="top-info-bar" style="border-radius: 25px 25px 0 0;">
                <button class="btn-whatsapp" onclick="copySummary()">WHATSAPP SUMMARY üìä</button>
                <button onclick="toggleLdr(false)" style="background:var(--danger); color:white; border:none; padding:8px 15px; border-radius:12px;">Close</button>
            </div>
            <div class="ldr-body"><div id="pList"></div><div class="table-scroll"><table><thead id="tHead"></thead><tbody id="tBody"></tbody></table></div></div>
        </div>
        <div class="floating-toggle" onclick="toggleLdr(true)">üèÜ SCORES</div>
    </div>
  </div>

<script>
  const firebaseConfig = { apiKey: "AIzaSyARuiRsbkgz25U0kKPqKEYUyhk78VJfgmk", authDomain: "joels-bucks.firebaseapp.com", databaseURL: "https://joels-bucks-default-rtdb.firebaseio.com", projectId: "joels-bucks", storageBucket: "joels-bucks.firebasestorage.app", messagingSenderId: "14159721912", appId: "1:14159721912:web:4dffa0a82be95974e80b4d" };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  
  const course = [
    { t: "1. BetMGM Bar", l: "Park MGM", p: 4, di: "Pint of Lager/IPA", gi: "Roulette: Bet $10 on Red." },
    { t: "2. Mama Rabbit", l: "Park MGM", p: 1, di: "Tequila Shot", gi: "Pokies: Two $5 spins." },
    { t: "3. The Fairway", l: "Walk to Cosmo", p: 5, di: "Margarita Yard Glass Buy & Finish", gi: "Coin Flip: $10 Heads/Tails." },
    { t: "4. Casino Floor", l: "Cosmopolitan", p: 3, di: "¬Ω Pint of Beer", gi: "Roulette: $10 Even." },
    { t: "5. Chandelier Bar", l: "Cosmopolitan", p: 1, di: "Lemon Drop Shot", gi: "Video Poker: $10 win/bust." },
    { t: "6. Lobby Bar", l: "Caesars Palace", p: 3, di: "Gin & Tonic", gi: "Baccarat: $10 Player." },
    { t: "7. Sportsbook", l: "Caesars Palace", p: 3, di: "Bottle of Beer", gi: "$10 bet on next team score." },
    { t: "8. Tilted Kilt", l: "The LINQ", p: 1, di: "Irish Car Bomb", gi: "Side Bet: $5 decided by Joel." },
    { t: "9. The Fairway", l: "Walk to Wynn", p: 5, di: "Colt 45 / Steel Reserve", gi: "Coin Flip: $10 Heads/Tails." },
    { t: "10. Wynn", l: "Parasol Down", p: 3, di: "Dirty PBR (Pickle juice backup)", gi: "High Limit: $10 one spin." },
    { t: "11. Encore", l: "Lobby Bar", p: 3, di: "Vodka Redbull", gi: "Roulette: Bet $10 on Black." },
    { t: "12. Peppermill", l: "Fireside Lounge", p: 4, di: "Signature Cocktail", gi: "Video Poker: $10 at the bar." },
    { t: "13. Fremont Street", l: "Walking", p: 4, di: "Large Vegas Slushie", gi: "No Gamble: Neon show." },
    { t: "14. Mega Bar", l: "Circa Resort", p: 3, di: "Draft Beer", gi: "Blackjack: Must hit soft 17." },
    { t: "15. Bar Prohibition", l: "Golden Gate", p: 1, di: "Shot of Whiskey", gi: "Craps: $10 on the Field." },
    { t: "16. Casino Floor", l: "Golden Nugget", p: 3, di: "Vodka Soda", gi: "Roulette: $10 on single number." },
    { t: "17. Claude's Bar", l: "Golden Nugget", p: 4, di: "Old Fashioned", gi: "3-reel machine: Max pull ($10)." },
    { t: "18. Binion's", l: "The Clubhouse", p: 4, di: "The Final Pint", gi: "FINALE: 50% winnings or $20." }
  ];

  let user = null, gCode = null, cIdx = 0, currentPlayers = [], viewTarget = null;

  function handleAuth() {
    const u = document.getElementById('logUser').value.trim();
    const p = document.getElementById('logPass').value.trim();
    if(!u || !p) return alert("Fields required");
    db.ref(`users/${u}`).once('value', s => {
      if(s.exists()) { if(s.val().pass === p) { user = s.val(); loginSuccess(); } else alert("Wrong password"); }
      else { user = { name: u, pass: p, games: {} }; db.ref(`users/${u}`).set(user).then(loginSuccess); }
    });
  }

  function loginSuccess() {
    localStorage.setItem('jk_user', user.name); v('authView', 0); v('dashView', 1);
    document.getElementById('dashTitle').innerText = `G'day, ${user.name}`;
    if(user.name === "Admin") document.getElementById('adminBtn').style.display = 'block';
    loadDashboard();
  }

  function loadDashboard() {
    db.ref(`users/${user.name}/games`).on('value', snap => {
        const alist = document.getElementById('activeList'), hlist = document.getElementById('historyList');
        alist.innerHTML = ''; hlist.innerHTML = '';
        snap.forEach(g => {
            const data = g.val();
            const item = `<div style="background:var(--card); padding:15px; border-radius:10px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;"><span>${data.code}</span><button onclick="enterGame('${data.code}')" style="background:var(--primary); color:#fff; border:none; padding:8px 12px; border-radius:5px;">Resume</button></div>`;
            if(data.status === 'active') alist.innerHTML += item; else hlist.innerHTML += item;
        });
    });
  }

  function enterGame(code) {
    gCode = code; viewTarget = user.name; v('dashView', 0); v('gameView', 1);
    document.getElementById('roomTag').innerText = gCode;
    db.ref(`games/${gCode}/players/${user.name}`).update({ name: user.name, drinkTotal: 0, gambleTotal: 0, sundryTotal: 0 });
    db.ref(`games/${gCode}`).on('value', snap => {
        const data = snap.val(); if(!data || data.status === 'archived') { exitGame(); return; }
        if(data.host === user.name) document.getElementById('hostPanel').style.display = 'block';
        currentPlayers = Object.values(data.players || {}).sort((a,b) => ((a.drinkTotal||0)+(a.gambleTotal||0)+(a.sundryTotal||0)) - ((b.drinkTotal||0)+(b.gambleTotal||0)+(b.sundryTotal||0)));
        
        const list = document.getElementById('pList'); list.innerHTML = '';
        currentPlayers.forEach((p, i) => list.innerHTML += `<div style="background:var(--card); padding:15px; border-radius:10px; margin-bottom:10px; display:flex; justify-content:space-between; border-left:6px solid ${p.name===user.name?'var(--primary)':'var(--border)'}"><span>${i===0?'üëë ':''}${p.name}</span><b>${(p.drinkTotal||0)+(p.gambleTotal||0)+(p.sundryTotal||0)}</b></div>`);
        
        const head = document.getElementById('tHead'); let headH = '<tr><th>Hole</th>'; currentPlayers.forEach(p => headH += `<th>${p.name} (${(p.drinkTotal||0)+(p.gambleTotal||0)+(p.sundryTotal||0)})</th>`); head.innerHTML = headH + '</tr>';
        const body = document.getElementById('tBody'); body.innerHTML = '';
        for(let i=0; i<18; i++) {
            let rD = `<tr class="row-drink"><td>Hole ${i+1} Drink</td>`, rG = `<tr class="row-gamble"><td>Hole ${i+1} Gamble</td>`, rS = `<tr class="row-sundry"><td>Hole ${i+1} Sundry</td>`;
            currentPlayers.forEach(p => { const h = (p.holes && p.holes[i]) ? p.holes[i] : {d:0, g:0, s:0}; rD += `<td>${h.d||0}</td>`; rG += `<td>${h.g||0}</td>`; rS += `<td>${h.s||0}</td>`; });
            body.innerHTML += rD + '</tr>' + rG + '</tr>' + rS + '</tr>';
        }

        const sel = document.getElementById('activeUserSelect'); const prev = sel.value; sel.innerHTML = ''; 
        currentPlayers.forEach(p => sel.innerHTML += `<option value="${p.name}">${p.name === user.name ? 'Scoring for: ME' : 'Scoring for: ' + p.name}</option>`);
        sel.value = prev || viewTarget;
    });
    renderHole();
  }

  function switchUser(name) { viewTarget = name; renderHole(); }
  function addFella() { const n = document.getElementById('newFellaName').value.trim(); if(!n) return; db.ref(`games/${gCode}/players/${n}`).set({ name: n, drinkTotal: 0, gambleTotal: 0, sundryTotal: 0 }); document.getElementById('newFellaName').value = ''; }

  function renderHole() {
    const h = course[cIdx]; document.getElementById('holeJump').value = cIdx;
    document.getElementById('holeInfo').innerHTML = `<div style="font-size:1.4rem; color:var(--primary); font-weight:bold;">${h.t}</div><div style="font-size:12px; color:#888;">${h.l}</div><div style="margin-top:10px; font-size:14px; padding:10px; border-radius:8px; background:rgba(33,150,243,0.1); border:1px solid var(--blue);"><b>DRINK:</b> ${h.di} (PAR ${h.p})</div><div style="margin-top:10px; font-size:14px; padding:10px; border-radius:8px; background:rgba(255,215,0,0.1); border:1px solid var(--accent);"><b>GAMBLE:</b> ${h.gi}</div>`;
    db.ref(`games/${gCode}/players/${viewTarget}/holes/${cIdx}`).once('value', s => { const d = s.val() || {d:0, g:0, s:0}; document.getElementById('dDisp').innerText = d.d || 0; document.getElementById('gDisp').innerText = d.g || 0; document.getElementById('sDisp').innerText = d.s || 0; });
  }

  function adj(type, amt) {
    const el = document.getElementById(type + 'Disp'); let val = parseInt(el.innerText) + amt; el.innerText = val;
    const ref = db.ref(`games/${gCode}/players/${viewTarget}`);
    ref.once('value', s => {
        const p = s.val(), old = (p.holes && p.holes[cIdx]) ? p.holes[cIdx] : {d:0, g:0, s:0};
        let up = {}; 
        if(type === 'd') { up['drinkTotal'] = (p.drinkTotal||0)-(old.d||0)+val; up[`holes/${cIdx}/d`] = val; } 
        else if(type === 'g') { up['gambleTotal'] = (p.gambleTotal||0)-(old.g||0)+val; up[`holes/${cIdx}/g`] = val; }
        else { up['sundryTotal'] = (p.sundryTotal||0)-(old.s||0)+val; up[`holes/${cIdx}/s`] = val; }
        ref.update(up);
    });
  }

  function copySummary() {
    let summary = `‚õ≥ JK'S BUCKS NIGHT TOTALS (Hole ${cIdx+1}):\n\n`;
    currentPlayers.forEach((p, i) => { summary += `${i+1}. ${p.name}: ${(p.drinkTotal||0)+(p.gambleTotal||0)+(p.sundryTotal||0)}\n`; });
    summary += `\nüîó Live: https://www.033.eu`;
    const el = document.createElement('textarea'); el.value = summary; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
    alert("WhatsApp Summary Copied!");
  }

  function shareCode() { const text = `Join JK's Bucks Night Room! \nRoom Code: ${gCode} \n\nPlay here: https://www.033.eu`; if (navigator.share) { navigator.share({ title: "JK's Vegas", text: text }); } else { alert("Copy & Share:\n" + text); } }
  function archiveGame() { if(!confirm("Archive?")) return; db.ref(`games/${gCode}/status`).set('archived'); db.ref(`games/${gCode}/players`).once('value', s => { s.forEach(p => db.ref(`users/${p.key}/games/${gCode}/status`).set('archived')); }); }
  function saveHole() { if(cIdx < 17) { cIdx++; renderHole(); } else alert("Last hole saved!"); }
  function jumpHole(i) { cIdx = parseInt(i); renderHole(); }
  function toggleLdr(open) { document.getElementById('leaderboardDrawer').classList.toggle('open', open); }
  function v(id, s) { document.getElementById(id).style.display = s ? 'flex' : 'none'; }
  function exitGame() { v('gameView', 0); v('dashView', 1); gCode = null; }
  function logout() { localStorage.clear(); location.reload(); }
  
  course.forEach((h, i) => {
    document.getElementById('holeJump').innerHTML += `<option value="${i}">Hole ${i+1}</option>`;
    document.getElementById('fullCourseList').innerHTML += `<div class="detail-box"><b>Hole ${i+1}: ${h.t}</b> (${h.l})<br>üç∫ ${h.di} (Par ${h.p})<br>üé≤ ${h.gi}</div>`;
  });
  const saved = localStorage.getItem('jk_user'); if(saved) db.ref(`users/${saved}`).once('value', s => { user = s.val(); loginSuccess(); });
</script>
</body>
</html>
