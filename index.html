<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>JK‚Äôs Bucks Night 2026 - Live</title>
<style>
  :root { --primary: #4CAF50; --bg: #121212; --card: #1e1e1e; --text: #ffffff; --border: #333; --danger: #f44336; --accent: #FFD700; --blue: #2196F3; }
  
  html, body { 
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
    background-color: var(--bg); color: var(--text); 
    margin: 0; padding: 0; height: 100%; width: 100%; 
    position: fixed; top: 0; left: 0; overflow: hidden; overscroll-behavior: none;
    font-size: 16px; 
  }
  
  .view { display: none; height: 100%; width: 100%; position: absolute; top: 0; left: 0; flex-direction: column; background: var(--bg); }
  .active-view { display: flex !important; }

  .app-container { width: 100%; height: 100%; display: flex; flex-direction: column; position: relative; }

  #mainContent { flex: 1; padding: 15px; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 140px; box-sizing: border-box; }

  .top-info-bar { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: #000; border-bottom: 1px solid #333; flex-shrink: 0; }
  .room-tag { font-family: monospace; font-weight: bold; color: var(--accent); font-size: 18px; }
  .btn-share-top { background: var(--blue); color: white; border: none; padding: 8px 14px; border-radius: 8px; font-weight: bold; font-size: 12px; }

  .hole-jump-select { width: 100%; padding: 15px; background: #222; color: var(--primary); border: 1px solid #444; border-radius: 10px; font-weight: bold; margin-bottom: 12px; font-size: 16px; text-align-last:center; }

  #leaderboardDrawer { 
    position: absolute; bottom: 0; left: 0; width: 100%; height: 88%; 
    background: #1a1a1a; border-top: 4px solid var(--primary); 
    border-top-left-radius: 25px; border-top-right-radius: 25px;
    z-index: 2000; transition: transform 0.4s cubic-bezier(0.1, 0.7, 0.1, 1);
    transform: translateY(105%); display: flex; flex-direction: column;
    box-shadow: 0 -10px 40px rgba(0,0,0,0.9);
  }
  #leaderboardDrawer.open { transform: translateY(0); }

  .ldr-body { flex: 1; overflow-y: auto !important; -webkit-overflow-scrolling: touch; padding: 15px; padding-bottom: 60px; }

  .table-scroll { width: 100%; overflow-x: auto !important; margin-top: 15px; background: #000; border-radius: 12px; -webkit-overflow-scrolling: touch; }

  .row-drink { background: rgba(33, 150, 243, 0.15) !important; color: #90caf9; }
  .row-gamble { background: rgba(255, 215, 0, 0.1) !important; color: #fff59d; }

  .player-row { background: var(--card); padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; border-left: 6px solid var(--border); font-size: 1rem; }
  .player-row.is-me { border-left-color: var(--primary); background: #1a2a1a; }

  .btn-math { background: #333; color: white; border: none; width: 65px; height: 65px; font-size: 30px; font-weight: bold; cursor: pointer; border-radius: 12px; }
  .score-display { font-size: 2rem; font-weight: bold; width: 65px; text-align: center; color: var(--primary); }

  .btn-main { background: var(--primary); color: white; border: none; width: 100%; padding: 22px; border-radius: 15px; margin-bottom: 12px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
  .btn-side { flex: 1; background: #444; color: white; border: none; padding: 18px; border-radius: 12px; font-weight: bold; font-size: 0.9rem; text-align: center; text-decoration: none; display: flex; align-items: center; justify-content: center; }
  
  input { width: 100%; max-width: 320px; padding: 22px; border-radius: 15px; border: 1px solid #444; background: #222; color: #fff; margin-bottom: 15px; text-align: center; font-size: 1.4rem; text-transform: uppercase;}

  .floating-toggle { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--primary); color: white; padding: 18px 45px; border-radius: 50px; font-weight: bold; box-shadow: 0 8px 20px rgba(0,0,0,0.6); z-index: 1500; border: 2px solid #fff; }

  table { width: 100%; border-collapse: collapse; font-size: 11px; color: white; }
  th, td { border: 1px solid #333; padding: 10px; text-align: center; min-width: 130px; }
  th { background: #222; color: var(--primary); font-weight: bold; }

  #hostPanel { display:none; background:#3d1414; padding:15px; border-radius:12px; border: 2px solid var(--danger); margin-bottom: 15px; }
</style>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>

  <div id="loginView" class="view active-view" style="justify-content: center; align-items: center; text-align: center; padding: 20px;">
    <h1 style="color:var(--primary); font-size: 2rem; margin-bottom: 30px;">‚õ≥ JK‚ÄôS BUCKS NIGHT 2026</h1>
    <input type="text" id="uName" placeholder="Your Name">
    <input type="text" id="rCode" placeholder="Room Code" maxlength="4">
    <button class="btn-main" onclick="auth(true)">üëë Host New Game</button>
    <button class="btn-main" style="background:#333;" onclick="auth(false)">üçª Join Game</button>
  </div>

  <div id="appView" class="view">
    <div class="app-container">
        <div class="top-info-bar">
            <div>CODE: <span id="roomTag" class="room-tag">----</span></div>
            <button class="btn-share-top" onclick="shareCode()">INVITE FELLAS üì≤</button>
        </div>

        <div id="mainContent">
            <select id="holeJump" class="hole-jump-select" onchange="jumpHole(this.value)"></select>

            <div class="hole-header" id="holeInfo"></div>
            
            <div class="scoring-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span>üç∫ Drink Strokes</span>
                    <div class="controls-inline">
                        <button class="btn-math" onclick="adj('d',-1)">‚àí</button>
                        <div class="score-display" id="dDisp">0</div>
                        <button class="btn-math" onclick="adj('d',1)">+</button>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span>üé≤ Gamble Strokes</span>
                    <div class="controls-inline">
                        <button class="btn-math" onclick="adj('g',-1)">‚àí</button>
                        <div class="score-display" id="gDisp">0</div>
                        <button class="btn-math" onclick="adj('g',1)">+</button>
                    </div>
                </div>
            </div>
            
            <button id="saveBtn" class="btn-main" style="background:var(--blue);" onclick="saveHole()">üíæ Save Hole Score</button>
            
            <div id="hostPanel">
                <h3 style="margin-top:0; font-size:12px; color:var(--danger); text-align:center;">üö® HOST PANEL</h3>
                <select id="pSelect" style="width:100%; padding:15px; margin-bottom:12px; background:#222; color:white; border-radius:10px; border: 1px solid #444; font-size: 16px;"></select>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span>Penalty Strokes:</span>
                    <div class="controls-inline">
                        <button class="btn-math" style="width:50px; height:50px;" onclick="adjHost(-1)">‚àí</button>
                        <div class="score-display" id="hostVal">0</div>
                        <button class="btn-math" style="width:50px; height:50px;" onclick="adjHost(1)">+</button>
                    </div>
                </div>
                <button class="btn-main" style="background:var(--danger); padding:15px;" onclick="applyMod()">Apply Strokes</button>
            </div>

            <button class="btn-main" style="background:#444;" onclick="v('rulesView',1)">üìú THE RULES & GUIDE</button>
            <div style="display:flex; gap:10px;">
                <a href="https://www.google.com/maps/dir/Park+MGM,+Las+Vegas+Blvd+S,+Las+Vegas,+NV/Cosmopolitan+of+Las+Vegas,+Las+Vegas+Blvd+S,+Las+Vegas,+NV/Caesars+Palace,+Las+Vegas+Blvd+S,+Las+Vegas,+NV/The+LINQ+Hotel,+Las+Vegas+Blvd+S,+Las+Vegas,+NV/Wynn+Las+Vegas,+Las+Vegas+Blvd+S,+Las+Vegas,+NV" target="_blank" class="btn-side" style="background:#ea4335;">üöÄ Strip GPS</a>
                <a href="https://www.google.com/maps/dir/Fremont+Street+Experience,+Fremont+St,+Las+Vegas,+NV/Circa+Resort+%26+Casino,+Fremont+St+Experience,+Las+Vegas,+NV/Golden+Gate+Hotel+%26+Casino,+Fremont+St+Experience,+Las+Vegas,+NV/Golden+Nugget+Las+Vegas+Hotel+%26+Casino,+Fremont+St,+Las+Vegas,+NV/Binion's+Gambling+Hall,+Fremont+St,+Las+Vegas,+NV" target="_blank" class="btn-side" style="background:#fbbc05;">üöÄ Fremont GPS</a>
            </div>
            <button style="background:none; border:none; color:#444; padding: 25px; width:100%; font-size: 12px;" onclick="leave()">Reset Session</button>
        </div>

        <div id="leaderboardDrawer">
            <div class="top-info-bar" style="border-radius: 25px 25px 0 0;">
                <span style="font-weight:bold; color:var(--primary); font-size: 1.2rem;">üèÜ LIVE SCORES</span>
                <button onclick="toggleLdr(false)" style="background:var(--danger); color:white; border:none; padding:10px 20px; border-radius:12px; font-weight:bold;">Close</button>
            </div>
            <div class="ldr-body">
                <div id="pList"></div>
                <div class="table-scroll"><table><thead id="tHead"></thead><tbody id="tBody"></tbody></table></div>
            </div>
        </div>
    </div>
  </div>

  <div id="rulesView" class="view" style="justify-content: flex-start; padding: 20px; overflow-y: auto;">
    <h1 style="color:var(--primary); font-size: 1.8rem;">THE RULES</h1>
    <button class="btn-main" onclick="v('rulesView',0)">Back to Game</button>
    <div class="detail-box"><b>üç∫ Drink Par:</b> Sips to finish.<br><b>üíµ Gambling Par ($10 Buy-in):</b> Birdie (-1): Profit | Par (0): Break Even | Bogey (+1): Loss | Penalty (+3): Refusal</div>
    <div class="detail-box" style="border-color: var(--danger);"><b>HAZARDS:</b> ‚Ä¢ <b>The Curdle (+2):</b> Hesitating on Car Bomb. ‚Ä¢ <b>Vomiting (+3):</b> Out of Bounds.</div>
    <h2 style="color:var(--primary); margin-top:20px;">COURSE GUIDE</h2>
    <div id="oList"></div>
  </div>

  <div class="floating-toggle" onclick="toggleLdr(true)">üèÜ SCORES</div>

<script>
  const firebaseConfig = { apiKey: "AIzaSyARuiRsbkgz25U0kKPqKEYUyhk78VJfgmk", authDomain: "joels-bucks.firebaseapp.com", databaseURL: "https://joels-bucks-default-rtdb.firebaseio.com", projectId: "joels-bucks", storageBucket: "joels-bucks.firebasestorage.app", messagingSenderId: "14159721912", appId: "1:14159721912:web:4dffa0a82be95974e80b4d" };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  
  const course = [
    { t: "1. BetMGM Bar", l: "Park MGM", p: 4, di: "Pint of Lager/IPA", gi: "Roulette: Bet $10 on Red." },
    { t: "2. Mama Rabbit", l: "Park MGM", p: 1, di: "Tequila Shot", gi: "Pokies: Two $5 spins." },
    { t: "3. The Fairway", l: "Walk to Cosmo", p: 5, di: "Margarita Yard Glass", gi: "Coin Flip: $10 Heads/Tails." },
    { t: "4. Casino Floor", l: "Cosmo", p: 3, di: "¬Ω Pint of Beer", gi: "Roulette: $10 Even." },
    { t: "5. Chandelier Bar", l: "Cosmo", p: 1, di: "Lemon Drop Shot", gi: "Video Poker: $10 win/bust." },
    { t: "6. Lobby Bar", l: "Caesars", p: 3, di: "Gin & Tonic", gi: "Baccarat: $10 Player." },
    { t: "7. Sportsbook", l: "Caesars", p: 3, di: "Bottle of Beer", gi: "$10 bet on next team score." },
    { t: "8. Tilted Kilt", l: "The LINQ", p: 1, di: "Irish Car Bomb", gi: "$5 side bet." },
    { t: "9. The Fairway", l: "Walk to Wynn", p: 5, di: "Colt 45 walk", gi: "Coin Flip: $10 Heads/Tails." },
    { t: "10. Wynn", l: "Parasol Down", p: 3, di: "Dirty PBR (Pickle juice)", gi: "High Limit: $10 one spin." },
    { t: "11. Encore", l: "Lobby Bar", p: 3, di: "Vodka Redbull", gi: "Roulette: $10 Black." },
    { t: "12. Peppermill", l: "Fireside", p: 4, di: "Signature Cocktail", gi: "$10 Video Poker." },
    { t: "13. Fremont St", l: "Walking", p: 4, di: "Vegas Slushie", gi: "No Gamble: Neon show." },
    { t: "14. Mega Bar", l: "Circa", p: 3, di: "Draft Beer", gi: "Blackjack: Hit soft 17. Can double/split." },
    { t: "15. Bar Prohibition", l: "Golden Gate", p: 1, di: "Shot of Whiskey", gi: "Craps: $10 Field." },
    { t: "16. Casino Floor", l: "Golden Nugget", p: 3, di: "Vodka Soda", gi: "Roulette: $10 single number." },
    { t: "17. Claude's Bar", l: "Golden Nugget", p: 4, di: "Old Fashioned", gi: "3-reel machine: Max pull." },
    { t: "18. Binion's", l: "The Clubhouse", p: 4, di: "Final Pint", gi: "FINALE: Roulette. 50% winnings or $20." }
  ];

  let mId = localStorage.getItem('mId'), gCode = localStorage.getItem('gCode'), hId = localStorage.getItem('hId'), cIdx = parseInt(localStorage.getItem('cIdx')) || 0;

  function auth(isHost) {
    const name = document.getElementById('uName').value.trim();
    if (isHost) { 
        gCode = Math.random().toString(36).substring(2, 6).toUpperCase(); 
        const r = db.ref(`games/${gCode}/players`).push(); 
        mId = r.key; hId = mId; 
        db.ref(`games/${gCode}`).set({ host: hId }).then(() => {
            r.set({ id: mId, name: name, drinkTotal: 0, gambleTotal: 0 }).then(start);
        });
    } else { 
        gCode = document.getElementById('rCode').value.trim().toUpperCase(); 
        db.ref(`games/${gCode}/host`).once('value', s => { 
            if(!s.exists()) return alert("Room not found!");
            const r = db.ref(`games/${gCode}/players`).push(); 
            mId = r.key; hId = s.val();
            r.set({ id: mId, name: name, drinkTotal: 0, gambleTotal: 0 }).then(start);
        }); 
    }
  }

  function start() {
    localStorage.setItem('mId', mId); localStorage.setItem('gCode', gCode); localStorage.setItem('hId', hId);
    document.getElementById('loginView').classList.remove('active-view'); 
    document.getElementById('appView').classList.add('active-view');
    document.getElementById('roomTag').innerText = gCode;
    if (mId === hId) document.getElementById('hostPanel').style.display = 'block';
    
    db.ref(`games/${gCode}/players`).on('value', snap => {
      if(!snap.exists()) return;
      const allPs = []; 
      snap.forEach(c => allPs.push(c.val()));
      
      // AUTO SORT: BEST (LOWEST) TO WORST (HIGHEST)
      allPs.sort((a,b) => ((a.drinkTotal||0)+(a.gambleTotal||0)) - ((b.drinkTotal||0)+(b.gambleTotal||0)));
      
      const list = document.getElementById('pList'); list.innerHTML = '';
      allPs.forEach((p, i) => list.innerHTML += `<div class="player-row ${p.id === mId ? 'is-me' : ''}"><span>${i===0?'üëë ':''}${p.name}</span><b>${(p.drinkTotal||0)+(p.gambleTotal||0)}</b></div>`);
      
      const head = document.getElementById('tHead'); 
      let headH = '<tr><th>Hole</th>'; 
      allPs.forEach(p => headH += `<th>${p.name} (${(p.drinkTotal||0)+(p.gambleTotal||0)})</th>`); 
      head.innerHTML = headH + '</tr>';
      
      const body = document.getElementById('tBody'); body.innerHTML = '';
      for(let i=0; i<18; i++) {
          let rD = `<tr class="row-drink"><td>Hole ${i+1} Drinking</td>`, rG = `<tr class="row-gamble"><td>Hole ${i+1} Gambling</td>`;
          allPs.forEach(p => { const h = (p.holes && p.holes[i]) ? p.holes[i] : {d:0, g:0}; rD += `<td>${h.d||0}</td>`; rG += `<td>${h.g||0}</td>`; });
          body.innerHTML += rD + '</tr>' + rG + '</tr>';
      }
      
      const sel = document.getElementById('pSelect'); const prev = sel.value; sel.innerHTML = ''; 
      allPs.forEach(p => sel.innerHTML += `<option value="${p.id}">${p.name}</option>`); 
      if(prev) sel.value = prev;
    });
    render();
  }

  function render() {
    const h = course[cIdx]; document.getElementById('holeJump').value = cIdx;
    document.getElementById('holeInfo').innerHTML = `<div class="hole-title">${h.t}</div><div style="font-size:12px;color:#888;">${h.l}</div><div class="detail-box drink"><div class="par-badge">PAR ${h.p}</div><b>DRINK:</b> ${h.di}</div><div class="detail-box gamble"><b>GAMBLE:</b> ${h.gi}</div>`;
    db.ref(`games/${gCode}/players/${mId}/holes/${cIdx}`).once('value', s => { const d = s.val() || {d:0, g:0}; document.getElementById('dDisp').innerText = d.d||0; document.getElementById('gDisp').innerText = d.g||0; });
  }

  function adj(type, amt) {
    const el = document.getElementById(type + 'Disp'); let val = parseInt(el.innerText) + amt; el.innerText = val;
    const ref = db.ref(`games/${gCode}/players/${mId}`);
    ref.once('value', s => {
      const p = s.val(), old = (p.holes && p.holes[cIdx]) ? p.holes[cIdx] : {d:0, g:0}; let up = {};
      if(type === 'd') { up['drinkTotal'] = (p.drinkTotal||0) - (old.d||0) + val; up[`holes/${cIdx}/d`] = val; }
      else { up['gambleTotal'] = (p.gambleTotal||0) - (old.g||0) + val; up[`holes/${cIdx}/g`] = val; }
      ref.update(up);
    });
  }

  function adjHost(a) { let el = document.getElementById('hostVal'); el.innerText = parseInt(el.innerText) + a; }
  function applyMod() { const tId = document.getElementById('pSelect').value; const val = parseInt(document.getElementById('hostVal').innerText); db.ref(`games/${gCode}/players/${tId}`).once('value', s => { db.ref(`games/${gCode}/players/${tId}`).update({ drinkTotal: (s.val().drinkTotal || 0) + val }); document.getElementById('hostVal').innerText = 0; alert("Done!"); }); }
  function saveHole() { if(cIdx === 17) alert("All 18 Saved!"); else jumpHole(cIdx + 1); }
  function jumpHole(i) { cIdx = parseInt(i); localStorage.setItem('cIdx', cIdx); render(); }
  function toggleLdr(open) { document.getElementById('leaderboardDrawer').classList.toggle('open', open); }
  function v(id, show) { document.getElementById(id).style.display = show ? 'flex' : 'none'; }
  function leave() { if(confirm("Clear session?")) { localStorage.clear(); location.reload(); } }
  function shareCode() { const text = `Join JK's Bucks Night! Code: ${gCode} \n\nPlay here: https://vegas.033.eu`; if (navigator.share) navigator.share({ title: "JK's Vegas", text: text, url: "https://vegas.033.eu" }); else alert("Code: " + gCode); }

  course.forEach((h, i) => document.getElementById('holeJump').innerHTML += `<option value="${i}">Hole ${i+1} - ${h.t}</option>`);
  course.forEach((h, i) => document.getElementById('oList').innerHTML += `<div class="detail-box"><b>Hole ${i+1}: ${h.t}</b><p>üç∫ ${h.di}<br>üé≤ ${h.gi}</p></div>`);
  if(mId && gCode) db.ref(`games/${gCode}/players/${mId}`).once('value', s => { if(s.exists()) start(); else leave(); });
</script>
</body>
</html>
